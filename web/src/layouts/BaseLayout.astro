---
interface Props {
  title: string;
  description: string;
  ogImage?: string;
}

const { title, description, ogImage = 'https://saintjohn.jonaylor.com/assets/og.jpg' } = Astro.props;
const currentYear = new Date().getFullYear();
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <meta name="description" content={description}>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content={Astro.url}>
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:image" content={ogImage}>

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content={Astro.url}>
    <meta property="twitter:title" content={title}>
    <meta property="twitter:description" content={description}>
    <meta property="twitter:image" content={ogImage}>

    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#FFFFFF">

    <link rel="stylesheet" href="/style.css">

    <!-- Privacy-friendly analytics by Plausible -->
    <script async src="https://plausible.io/js/pa-5GWeDiEsEjip5b2JeKHRv.js"></script>
    <script is:inline>
      window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
      plausible.init()
    </script>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">Saint John</div>
            <nav>
                <button id="salvation-toggle" class="salvation-button" aria-label="Toggle Salvation Mode">
                    ✝ Enter Salvation
                </button>
            </nav>
        </div>
    </header>

    <slot />

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <p>&copy; {currentYear} Saint John</p>
                    <p>Made by <a href="https://jonaylor.com" target="_blank">Johannes Naylor</a></p>
                </div>
                <div class="footer-right">
                    <a href="/privacy">Privacy Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Salvation Mode Toggle
        const salvationToggle = document.getElementById('salvation-toggle');
        const body = document.body;

        // Check localStorage for saved preference
        const salvationMode = localStorage.getItem('salvationMode') === 'true';
        if (salvationMode) {
            body.classList.add('salvation-mode');
            if (salvationToggle) {
                salvationToggle.innerHTML = '✝ Return to Earth';
            }
        }

        salvationToggle?.addEventListener('click', () => {
            body.classList.toggle('salvation-mode');
            const isActive = body.classList.contains('salvation-mode');

            // Update button text
            if (salvationToggle) {
                salvationToggle.innerHTML = isActive ? '✝ Return to Earth' : '✝ Enter Salvation';
            }

            // Save preference
            localStorage.setItem('salvationMode', String(isActive));

            // Add a subtle effect
            body.style.transition = 'all 0.5s ease';
        });

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', (e) => {
                e.preventDefault();
                const href = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
                const target = document.querySelector(href || '');
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add scroll event listener for header shadow on scroll
        const header = document.querySelector('header');

        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;

            if (header) {
                if (currentScroll > 50) {
                    header.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.05)';
                } else {
                    header.style.boxShadow = 'none';
                }
            }
        });

        // Intersection Observer for fade-in animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const target = entry.target as HTMLElement;
                    target.style.opacity = '1';
                    target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe all features and showcase items for animation
        document.addEventListener('DOMContentLoaded', () => {
            const animatedElements = document.querySelectorAll('.feature, .showcase-item, .philosophy');

            animatedElements.forEach(el => {
                const element = el as HTMLElement;
                element.style.opacity = '0';
                element.style.transform = 'translateY(30px)';
                element.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(element);
            });
        });
    </script>
</body>
</html>
